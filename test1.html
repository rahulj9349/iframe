<!DOCTYPE html>
<html>
<head>
  <title>Iframe with Bootstrap Modal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
  body.modal-scroll-lock {
    position: fixed !important;
    width: 100%;
    overflow: hidden !important;
    top: 0 !important;
  }

  .modal-dialog {
    max-height: 100vh;
    display: flex;
    flex-direction: column;
    margin: auto;
  }

  .modal-content {
    flex: 1 1 auto;
    overflow: hidden;
  }

  .modal-body {
    overflow-y: auto;
    max-height: calc(100vh - 120px);
  }
</style>

</head>
<body>

  <!-- Sections with modal triggers -->
  <div class="section">Section 1 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 2 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 3 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 4 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 5 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 6 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 7 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 8 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 9 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>
  <div class="section">Section 10 <button class="btn btn-primary" onclick="openPopup()">Open Modal</button></div>

  <!-- Bootstrap Modal -->
  <div class="modal fade" id="popupModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Popup Modal</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>This modal scrolls inside itself.</p>
          <p>Dummy content:</p>
          <div style="height: 600px; background: #eee; padding: 10px;">Scrollable content...</div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

 <script>
  let scrollY = 0;
  let modal;

  function sendHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ type: 'childHeight', height }, '*');
  }

  function openPopup() {
    scrollY = window.scrollY;

    // Freeze body scroll by faking fixed position
    document.body.classList.add('modal-scroll-lock');
    document.body.style.top = `-${scrollY}px`;

    modal = new bootstrap.Modal(document.getElementById('popupModal'));
    modal.show();

    window.parent.postMessage({ type: 'modalOpened' }, '*');
  }

  document.getElementById('popupModal').addEventListener('hidden.bs.modal', () => {
    // Restore body
    document.body.classList.remove('modal-scroll-lock');
    document.body.style.top = '';

    // Restore scroll
    window.scrollTo({ top: scrollY, behavior: 'instant' });

    window.parent.postMessage({ type: 'modalClosed' }, '*');
  });

  window.addEventListener('message', function (event) {
    if (event.data?.type === 'getHeight') {
      sendHeight();
    }
  });

  window.addEventListener('load', sendHeight);
</script>


</body>
</html>
